#!/usr/bin/env node
import { program } from 'commander';
import chalk from 'chalk';
import {existsUnstagedFile, getLastCommit} from '../utils/git';
import { confirm } from '../utils/input';
import { runCmd } from '../utils/shell';

program
  .command('ac', { isDefault: true })
  .description('Add files without modify commit message')
  .action(run)
  .parse(process.argv);

async function run() {
  const message = await getLastCommit();
  if (await existsUnstagedFile() && await confirm('There are some unstaged files, yes to add them or no to skip add')) {
    await runCmd('git add .');
  }

  const cmd = `git commit -m "${message}" --amend`;
  if (await confirm(`Are you sure to run cmd: ${chalk.yellow(cmd)}?`)) {
    await runCmd(cmd);
  }
}
